---
- hosts: all

  tasks:
    - group_by: "key=os_{{ansible_distribution | lower}}"
      changed_when: False

- hosts: all
  gather_facts: no
  sudo: yes

  roles:
    - clock
    - banners
    - ntp
    - sudo
    - profile

- hosts:
    - os_centos
    - os_redhat
    - os_amazon

  gather_facts: no
  sudo: yes

  roles:
      - users
      - epel

- hosts: os_redhat
  gather_facts: no
  sudo: yes

  roles:
    - rhel-repos

# Do the SSH server configuration last, as disabling root login half way
# through an Ansible run can be... fun.
- hosts: all
  gather_facts: no
  sudo: yes

  roles:
    - ssh-server
